## 线程件间的通讯

主线程


决方案：

### 共享内存
1. 多个线程之间，共享一个类中的同一个对象
2. 任何一个线程对该对象中的变量做修改，其他线程也可以接收到修改之后的值
3. 这个时候多个线程对该对象保持一个强持有

强持有：从对象创建开始一直到程序结束，该对象的内存空间一直存在<br>
弱持有：只要对象不使用，该对象的内存空间就会被GC回收，使用时再重新分配。

优点
1. 比较省资源（CPU）<br>
2. 对程序的执行的效率不会有影响<br>

缺点
1. 没有主动方和被动方（发送方和接收方）<br>
2. 如果共享内存出现问题，跟共享内存涉及到的线程几乎全部完蛋<br>
3. 完成一次发送和接收会多消耗一次内存

适用场景：
1. 数据量比较小，每个线程之间的通讯的频率不高的情况下推荐使用共享内存

---

### 通信管道 （Stream）
PipedinputStream `管道输入方向` <br>
PipedoutStream `管道输出方向`

#### 线程间通信
都是子线程将消息发送`输出方向`，给主线程`输入方向`
1. 子线程将要发送的数据收集好
2. 将数据转换成2进制数据
3. 主线程接收到数据
4. 将消息转换成正常类型
5. 执行应有的操作


### 多线程面试中会提及的部分
#### 谈下对对多线程的理解
 * 用来非瞬时完成的耗时操作<br>
 * cpu来调用多线程，通过`strat（）`方法<br>
 优势：
   1. 充分利用cpu资源，将cpu空闲部分用于处理程序的耗时操作（网络，数据）<br>
   以上的操作和主线程用时运行，能够加快程序的运行效率。
 
 缺点:
   1. 对cpu过度依赖，在线程执行的过程中无法控制。
   
 * 适用场景 
   1. 所有耗时操作
 
 * 使用规则
   1. 不要在子线程去更新UI（通知用户）<br>
   2. 使用消息传递机制将子线程处理好的结果发回给主线程
   3. 异步方法和同步方法谁好：不一定
     
      异步方法：
       0. 每个子线程的执行不受约束
       0. 执行进度无法控制
         
      同步方法：
       0. 子线程的执行受约束，需要按照一定的规则来
       0. 太死板，不适合用于批量操作
       
#### 在你做过的项目中，哪些用过多线程，都是如何处理的？
 1. 从hive或者hadoop读取的大量的数据，会放在子线程中完成。
 2. 大量的数据修改。

#### 在以上的多线程操作中，遇到过什么问题，如何解决
 1. 并发（线程不安全）瞬时都对公共资源做操作→`脏读`
    1. 同步方法
    2. 给数据库的表加上锁
    
 2. 子线程的内存溢出（读取的数据太多）
    1. 分页（java部分的分页，数据库部分的分页）
     
       程序分页：一次性将要查询的数据全部读取到程序本地，并且存在内存中，每一次从本地内存中读取数据。和数据库无关。
       
       优点：一次数据库连接可以读取所有的数据，后面就可以不用连接数据库进行读取
       
       缺点：
          1. 对客户端的内存占用巨大
          2. 数据不是实时更新
          
       数据库分页---较大的数据查询：
       
       优点：实时更新，对程序的压力相对较小
       
       缺点：要频繁的链接数据库
       
#### 一个新的项目，打算如何处理多线程的部分（有哪些你会用到多线程，以及如何优化）
1. 充分利用jsp的缓存机制
2. 大的数据库查询尽可能使用数据库分页
3. 涉及到数据库层面的操作，都用框架完成（hibemate，mybaties）